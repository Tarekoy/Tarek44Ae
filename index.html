from telethon import TelegramClient, events
from config import API_ID, API_HASH, BOT_TOKEN=8027805011:AAHNnRgy-ir09oHN3uSsWYSLS7NyO6ZyJhU ADMIN_USER_ID, 7312762616,ZONE_ID, 2799758,MIN_WITHDRAW_AMOUNT=50

# Bot Client à¦šà¦¾à¦²à§ à¦•à¦°à¦¾
client = TelegramClient("bot", API_ID, API_HASH).start(bot_token=BOT_TOKEN) 8027805011:AAHNnRgy-ir09oHN3uSsWYSLS7NyO6ZyJhU 

# à¦‡à¦‰à¦œà¦¾à¦°à¦¦à§‡à¦° à¦¬à§à¦¯à¦¾à¦²à§‡à¦¨à§à¦¸ à¦Ÿà§à¦°à§à¦¯à¦¾à¦• à¦•à¦°à¦¤à§‡ Dictionary à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦›à¦¿
user_data = {}

@client.on(events.NewMessage(pattern="/start"))
async def start(event):
    user_id = event.sender_id
    if user_id not in user_data:
        user_data[user_id] = {"ads_watched": 0, "balance": 0.0}

    await event.respond(
        "ğŸ‘‹ Welcome to the Monetag Ad Bot!\n\n"
        "ğŸ¯ Watch ads & earn money!\n"
        "ğŸ’° Use /balance to check earnings\n"
        "âš¡ Use /watch_ad to watch an ad\n"
        "ğŸ§ Use /withdraw to request payment"
    )

@client.on(events.NewMessage(pattern="/watch_ad"))
async def watch_ad(event):
    user_id = event.sender_id

    if user_id not in user_data:
        user_data[user_id] = {"ads_watched": 10, "balance": 0.0}

    ad_url = f"https://syndication.exoclick.com/tag.php?zoneid={ZONE_ID}"

    user_data[user_id]["ads_watched"] += 1
    user_data[user_id]["balance"] += 0.15  # à¦ªà§à¦°à¦¤à¦¿à¦Ÿà¦¿ à¦¬à¦¿à¦œà§à¦à¦¾à¦ªà¦¨à§‡à¦° à¦œà¦¨à§à¦¯ 0.15 à¦Ÿà¦¾à¦•à¦¾

    await event.respond(
        f"ğŸ”” Ad Watched Successfully!\n\n"
        f"ğŸ“Š Total Ads Watched: {user_data[user_id]['ads_watched']}\n"
        f"ğŸ’° Earned Balance: {user_data[user_id]['balance']:.2f} BDT\n\n"
        f"ğŸ‘‰ [Click Here to Watch Ad]({ad_url})",
        link_preview=False
    )

@client.on(events.NewMessage(pattern="/balance"))
async def check_balance(event):
    user_id = event.sender_id

    if user_id not in user_data:
        await event.respond("ğŸš« You haven't watched any ads yet! Start earning with /watch_ad")
        return

    balance = user_data[user_id]["balance"]
    await event.respond(f"ğŸ’° Your Current Balance: {balance:.2f} BDT")

@client.on(events.NewMessage(pattern="/withdraw"))
async def withdraw(event):
    user_id = event.sender_id

    if user_id not in user_data or user_data[user_id]["balance"] < MIN_WITHDRAW_AMOUNT:
        await event.respond(f"ğŸš« Minimum withdraw amount is {MIN_WITHDRAW_AMOUNT} BDT")
        return

    await event.respond(
        "ğŸ§ Withdrawal Request Form\n\n"
        "ğŸ”¹ Send your payment method & details in this format:\n\n"
        "/request_withdraw bkash 017XXXXXXXX 100"
    )

@client.on(events.NewMessage(pattern="/request_withdraw (.*)"))
async def request_withdraw(event):
    user_id = event.sender_id
    if user_id not in user_data or user_data[user_id]["balance"] < MIN_WITHDRAW_AMOUNT:
        await event.respond(f"ğŸš« Insufficient Balance! You need at least {MIN_WITHDRAW_AMOUNT} BDT to withdraw.")
        return

    args = event.pattern_match.group(1).split()
    if len(args) != 3:
        await event.respond("ğŸš« Invalid Format! Use: /request_withdraw bkash 017XXXXXXXX 100")
        return

    method, phone, amount = args
    amount = float(amount)

    if amount > user_data[user_id]["balance"]:
        await event.respond("ğŸš« You don't have enough balance!")
        return

    # à¦‡à¦‰à¦œà¦¾à¦°à§‡à¦° à¦¬à§à¦¯à¦¾à¦²à§‡à¦¨à§à¦¸ à¦•à¦®à¦¾à¦¨à§‹
    user_data[user_id]["balance"] -= amount

    # à¦…à§à¦¯à¦¾à¦¡à¦®à¦¿à¦¨à¦•à§‡ à¦‰à¦‡à¦¥à¦¡à§à¦°à§Ÿà¦¾à¦² à¦°à¦¿à¦•à§‹à§Ÿà§‡à¦¸à§à¦Ÿ à¦ªà¦¾à¦ à¦¾à¦¨à§‹
    await client.send_message(
        ADMIN_USER_ID,7312762616
        f"ğŸ“¢ New Withdrawal Request\n\n"
        f"ğŸ‘¤ User: {user_id}\n"
        f"ğŸ’° Amount: {amount} BDT\n"
        f"ğŸ¦ Method: {method}\n"
        f"ğŸ“ Phone: {phone}"
    )

    await event.respond("âœ… Withdrawal request sent! Admin will process it soon.")

client.run_until_disconnected()